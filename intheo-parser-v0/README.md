# intheo-parser-v0

## no failure parser combinators

パーサーコンビネータは Haskell の素晴らしい成果の一つです。しかし、実用に耐えるものを自分で実装しようとすると、エラーメッセージやバックトラッキングなどにおいては作者の裁量が大きく、考慮しなければならないものが大きくて大変です。ならば、エラーをシンタックスに押し付けてパーサーはエラーを扱わず、バックトラッキングは pure な State Monad が持っている状態の分岐が可能であるという性質を利用して外付けで行えばいいのではないかと考えました。

### エラー

例えば、 `2 + 3` という数式は正しいが `2 +` という数式は正しくないというときは、普通はパースエラーになります。しかし、ここで `2 +` という式のための文法があればどうでしょうか？ パーサーは上手く動き、そしてシンタックスをチェックするときにエラーを出すという風にやることが出来ます。

### バックトラッキング

https://github.com/Hexirp/intheo/blob/ed7aa609683a4755c13af9b8d078f97831b7f456/intheo-parser-v0/src/Parser/NoFailure.hs#L78-L108

上記のコードを見てください。バックトラッキングの例として `backtrack` という関数を定義しています。まず、 `onHold` でパースを行いながらもカーソルの位置などの状態を変更することを保留します。次に、パースの結果をチェックして、それが悪いものだったら別のパーサーへ移行し、それが良い物だったらそのまま受け入れます。今回は `Either` 型を使いましたが、 `a -> Bool` などの述語を使う版も容易に作れるでしょう。

### 問題点

そもそも思い付きを形にしたものなので、実用的なものを作ることは難しそうです。また、私は経験不足なので断言できませんが、性能は悪そうです。
